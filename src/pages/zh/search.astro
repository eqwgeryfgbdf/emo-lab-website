---
import BaseHead from '../../components/BaseHead.astro';
import Header from '../../components/Header.astro';
import Footer from '../../components/Footer.astro';
import { SITE_TITLE, SITE_DESCRIPTION } from '../../consts';
---

<!doctype html>
<html lang="zh-Hant">
  <head>
    <BaseHead title={`搜尋 · ${SITE_TITLE}`} description={SITE_DESCRIPTION} />
    <style>
      .container { max-width: 960px; margin: 0 auto; padding: 1rem; }
      input { width: 100%; padding: 0.75rem; font-size: 1rem; }
      ul { list-style: none; padding: 0; }
      li { padding: 0.5rem 0; }
      .meta { color: rgb(var(--gray)); font-size: 0.9rem; }
    </style>
  </head>
  <body>
    <Header />
    <main class="container">
      <h1>搜尋</h1>
      <input id="q" type="search" placeholder="搜尋文章、標籤、分類..." />
      <ul id="results"></ul>
    </main>
    <Footer />
    <script is:inline>
      const q = document.getElementById('q');
      const list = document.getElementById('results');
      let data = [];
      fetch('/search.json?lang=zh').then(r => r.json()).then(json => { data = json; render(''); });
      q.addEventListener('input', () => render(q.value));
      function render(term) {
        const t = term.trim().toLowerCase();
        const items = !t ? [] : data.filter(i =>
          i.title.toLowerCase().includes(t)
          || (i.description||'').toLowerCase().includes(t)
          || (i.category||'').toLowerCase().includes(t)
          || (i.tags||[]).some(tag => tag.toLowerCase().includes(t))
        ).slice(0, 20);
        list.innerHTML = items.map(i => `
          <li>
            <a href="${i.url}">${i.title}</a>
            <div class="meta">${i.category ? i.category + ' · ' : ''}${(i.tags||[]).join(', ')}</div>
          </li>`).join('');
      }
    </script>
  </body>
  </html>

