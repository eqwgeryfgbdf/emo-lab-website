class DataLoader{constructor(){this.siteData=null;this.achievementsData=null;this.isLoading=false}async loadSiteData(){if(this.isLoading)return;this.isLoading=true;try{const response=await fetch('data/site-data.json');if(!response.ok){throw new Error(`HTTP error! status: ${response.status}`)}this.siteData=await response.json();return this.siteData}catch(error){console.error('Error loading site data:',error);return null}finally{this.isLoading=false}}async loadAchievementsData(){if(this.isLoading)return;this.isLoading=true;try{const response=await fetch('data/achievements.json');if(!response.ok){throw new Error(`HTTP error! status: ${response.status}`)}this.achievementsData=await response.json();return this.achievementsData}catch(error){console.error('Error loading achievements data:',error);return null}finally{this.isLoading=false}}getLabInfo(){return this.siteData?.lab||null}getTeamMembers(){return this.siteData?.lab?.team||[]}getLatestNews(limit=5){const news=this.siteData?.lab?.news||[];return news.slice(0,limit)}getAllNews(){return this.siteData?.lab?.news||[]}getMission(){return this.siteData?.lab?.mission||''}getContactInfo(){return this.siteData?.lab?.contact||{}}getPartners(category='all'){const partners=this.siteData?.lab?.partners||{};switch(category){case 'universities':return partners.universities||[];case 'schools':return partners.schools||[];case 'companies':return partners.companies||[];case 'all':default:return{universities:partners.universities||[],schools:partners.schools||[],companies:partners.companies||[]}}}getAllAchievements(){return this.achievementsData?.achievements||[]}getAchievementsByType(type){const achievements=this.getAllAchievements();if(type==='all'){return achievements}return achievements.filter(achievement=>achievement.type===type)}getAchievementStatistics(){return this.achievementsData?.statistics||{}}getFeaturedAchievements(limit=6){const achievements=this.getAllAchievements();const featured=achievements.filter(achievement=>{const award=achievement.award.toLowerCase();return award.includes('ÈáëÁâå')||award.includes('gold')||award.includes('best')||award.includes('Á¨¨‰∏ÄÂêç')||award.includes('Á¨¨‰∫åÂêç')||award.includes('‰∫ûËªç')||award.includes('Èà¶Èáë')});return featured.slice(0,limit)}searchAchievements(query){const achievements=this.getAllAchievements();const searchTerm=query.toLowerCase();return achievements.filter(achievement=>achievement.title.toLowerCase().includes(searchTerm)||achievement.name.toLowerCase().includes(searchTerm)||achievement.award.toLowerCase().includes(searchTerm))}formatDate(dateString){const date=new Date(dateString);return date.toLocaleDateString('zh-TW',{year:'numeric',month:'long',day:'numeric'})}getAchievementTypeDisplay(type){const typeMap={'competition':'Á´∂Ë≥ΩÊàêÊûú','paper':'Ë´ñÊñáÁôºË°®','award':'Áç≤ÁçéË®òÈåÑ'};return typeMap[type]||type}getAchievementCategoryColor(type){const colorMap={'competition':'#667eea','paper':'#28a745','award':'#ffc107'};return colorMap[type]||'#6c757d'}isDataLoaded(){return this.siteData!==null&&this.achievementsData!==null}async initialize(){try{await this.loadSiteData();this.loadAchievementsData().catch(error=>{console.warn('Achievements data loading failed:',error)});return this.isDataLoaded()}catch(error){console.error('Error initializing data loader:',error);return false}}async loadWithRetry(loadFunction,maxRetries=3){for(let i=0;i<maxRetries;i++){try{return await loadFunction()}catch(error){if(i===maxRetries-1)throw error;await new Promise(resolve=>setTimeout(resolve,1000*(i+1)))}}}}window.dataLoader=new DataLoader();document.addEventListener('DOMContentLoaded',()=>{window.dataLoader.initialize()});class EMOWebsite{constructor(){this.dataLoader=window.dataLoader;this.animationController=window.animationController;this.currentPage=this.getCurrentPage();this.init()}async init(){await this.waitForData();this.initNavigation();this.initPageContent();this.initEventListeners();this.initAnimations()}async waitForData(){let attempts=0;const maxAttempts=50;while(!this.dataLoader.isDataLoaded()&&attempts<maxAttempts){await new Promise(resolve=>setTimeout(resolve,100));attempts++}if(!this.dataLoader.isDataLoaded()){console.warn('Data loading timeout, continuing with limited functionality')}}getCurrentPage(){const path=window.location.pathname;const page=path.split('/').pop().replace('.html','')||'index';return page}initNavigation(){const navToggle=document.getElementById('navigation-toggle');const navMenu=document.getElementById('navigation-menu');if(navToggle&&navMenu){navToggle.addEventListener('click',()=>{navMenu.classList.toggle('navigation__menu--active');navToggle.classList.toggle('navigation__toggle--active')});}const navLinks=document.querySelectorAll('.navigation__link');navLinks.forEach(link=>{link.addEventListener('click',()=>{if(navMenu.classList.contains('navigation__menu--active')){navMenu.classList.remove('navigation__menu--active');navToggle.classList.remove('navigation__toggle--active')}})});this.handleNavigationScroll()}handleNavigationScroll(){const navigation=document.getElementById('navigation');let lastScrollY=window.scrollY;window.addEventListener('scroll',()=>{const currentScrollY=window.scrollY;if(currentScrollY>100){navigation.classList.add('navigation--scrolled')}else{navigation.classList.remove('navigation--scrolled')}if(currentScrollY>lastScrollY&&currentScrollY>200){navigation.style.transform='translateY(-100%)'}else{navigation.style.transform='translateY(0)'}lastScrollY=currentScrollY})}initPageContent(){switch(this.currentPage){case 'index':this.initHomePage();break;case 'about':this.initAboutPage();break;case 'team':this.initTeamPage();break;case 'achievements':this.initAchievementsPage();break;case 'partners':this.initPartnersPage();break;case 'contact':this.initContactPage();break}}initHomePage(){this.renderLatestNews();this.renderAboutPreview();this.renderAchievementHighlights()}renderLatestNews(){const newsGrid=document.getElementById('news-grid');if(!newsGrid)return;const news=this.dataLoader.getLatestNews(3);newsGrid.innerHTML=news.map(item=>`<div class="news__item scroll-animate"><div class="news__item-date">${this.dataLoader.formatDate(item.date)}</div><h3 class="news__item-title">${item.title}</h3></div>`).join('')}renderAboutPreview(){const aboutDescription=document.getElementById('about-description');if(!aboutDescription)return;const mission=this.dataLoader.getMission();const shortMission=mission.substring(0,200)+'...';aboutDescription.textContent=shortMission}renderAchievementHighlights(){const achievementsGrid=document.getElementById('achievements-grid');if(!achievementsGrid)return;const featuredAchievements=this.dataLoader.getFeaturedAchievements(4);achievementsGrid.innerHTML=featuredAchievements.map(achievement=>`<div class="achievement-card scroll-animate"><div class="achievement-card__icon">üèÜ</div><h3 class="achievement-card__title">${achievement.title}</h3><p class="achievement-card__description">${achievement.award}</p></div>`).join('')}initAboutPage(){this.renderMission()}renderMission(){const missionText=document.getElementById('mission-text');if(!missionText)return;const mission=this.dataLoader.getMission();missionText.innerHTML=`<p>${mission}</p>`}initTeamPage(){this.renderTeamMembers()}renderTeamMembers(){const teamGrid=document.getElementById('team-grid');if(!teamGrid)return;const teamMembers=this.dataLoader.getTeamMembers();teamGrid.innerHTML=teamMembers.map(member=>`<div class="team__member scroll-animate"><div class="team__member-image"><img src="${member.image||'images/team/default-avatar.jpg'}" alt="${member.name}" class="team__member-img"></div><div class="team__member-content"><h3 class="team__member-name">${member.name}</h3><p class="team__member-role">${member.role}</p><p class="team__member-description">${member.description}</p></div></div>`).join('')}initAchievementsPage(){this.renderAchievements();this.initAchievementFilters();this.renderAchievementStatistics();this.initModal()}renderAchievements(filter='all'){const achievementsGrid=document.getElementById('achievements-items');if(!achievementsGrid)return;const achievements=this.dataLoader.getAchievementsByType(filter);achievementsGrid.innerHTML=achievements.map(achievement=>`<div class="achievement-item scroll-animate" data-type="${achievement.type}"><div class="achievement-item__image"><img src="${achievement.image}" alt="${achievement.title}" class="achievement-item__img"></div><div class="achievement-item__content"><div class="achievement-item__category">${achievement.category}</div><h3 class="achievement-item__title">${achievement.title}</h3><p class="achievement-item__competition">${achievement.name}</p><div class="achievement-item__award">${achievement.award}</div><div class="achievement-item__date">${this.dataLoader.formatDate(achievement.date)}</div></div></div>`).join('')}initAchievementFilters(){const filterButtons=document.querySelectorAll('.achievements-filter__button');filterButtons.forEach(button=>{button.addEventListener('click',()=>{filterButtons.forEach(btn=>btn.classList.remove('achievements-filter__button--active'));button.classList.add('achievements-filter__button--active');const filter=button.dataset.filter;this.renderAchievements(filter)})})}renderAchievementStatistics(){const stats=this.dataLoader.getAchievementStatistics();const totalCompetitions=document.getElementById('total-competitions');const totalPapers=document.getElementById('total-papers');const totalAwards=document.getElementById('total-awards');const goldAwards=document.getElementById('gold-awards');if(totalCompetitions)totalCompetitions.textContent=stats.totalCompetitions||0;if(totalPapers)totalPapers.textContent=stats.totalPapers||0;if(totalAwards)totalAwards.textContent=stats.totalAwards||0;if(goldAwards)goldAwards.textContent=stats.goldAwards||0}initModal(){this.animationController.setupModalAnimations()}initPartnersPage(){this.renderPartners()}renderPartners(){const partners=this.dataLoader.getPartners();const universitiesGrid=document.getElementById('universities-grid');if(universitiesGrid){universitiesGrid.innerHTML=partners.universities.map(uni=>`<div class="partner-item scroll-animate"><h3 class="partner-item__name">${uni}</h3></div>`).join('')}const schoolsGrid=document.getElementById('schools-grid');if(schoolsGrid){schoolsGrid.innerHTML=partners.schools.map(school=>`<div class="partner-item scroll-animate"><h3 class="partner-item__name">${school}</h3></div>`).join('')}const companiesGrid=document.getElementById('companies-grid');if(companiesGrid){companiesGrid.innerHTML=partners.companies.map(company=>`<div class="partner-item scroll-animate"><h3 class="partner-item__name">${company}</h3></div>`).join('')}}initContactPage(){this.initContactForm()}initContactForm(){const form=document.getElementById('contact-form-element');if(!form)return;form.addEventListener('submit',(e)=>{e.preventDefault();this.handleFormSubmission(form)})}handleFormSubmission(form){const formData=new FormData(form);const data=Object.fromEntries(formData);if(!data.name||!data.email||!data.subject||!data.message){this.showNotification('Ë´ãÂ°´ÂØ´ÊâÄÊúâÂøÖÂ°´Ê¨Ñ‰Ωç','error');return}const emailRegex=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;if(!emailRegex.test(data.email)){this.showNotification('Ë´ãËº∏ÂÖ•ÊúâÊïàÁöÑÈõªÂ≠êÈÉµ‰ª∂Âú∞ÂùÄ','error');return}this.showNotification('Ë®äÊÅØÂ∑≤ÁôºÈÄÅÔºÅÊàëÂÄëÊúÉÁõ°Âø´ÂõûË¶ÜÊÇ®„ÄÇ','success');form.reset()}showNotification(message,type='info'){const notification=document.createElement('div');notification.className=`notification notification--${type}`;notification.textContent=message;document.body.appendChild(notification);setTimeout(()=>{notification.classList.add('notification--show')},100);setTimeout(()=>{notification.classList.remove('notification--show');setTimeout(()=>{notification.remove()},300)},3000)}initAnimations(){this.animationController.observeScrollElements();this.animationController.setupSmoothScrolling();if(this.currentPage==='index'){this.animationController.setupParallax()}}initEventListeners(){window.addEventListener('resize',this.debounce(()=>{this.handleResize()},250));window.addEventListener('scroll',this.throttle(()=>{this.handleScroll()},16))}handleResize(){this.animationController.observeScrollElements()}handleScroll(){}debounce(func,wait){let timeout;return function executedFunction(...args){const later=()=>{clearTimeout(timeout);func(...args)};clearTimeout(timeout);timeout=setTimeout(later,wait)}}throttle(func,limit){let inThrottle;return function(){const args=arguments;const context=this;if(!inThrottle){func.apply(context,args);inThrottle=true;setTimeout(()=>inThrottle=false,limit)}}}}document.addEventListener('DOMContentLoaded',()=>{window.emoWebsite=new EMOWebsite()});const notificationStyles=` .notification{position:fixed;top:20px;right:20px;padding:16px 24px;border-radius:8px;color:white;font-weight:500;z-index:10000;transform:translateX(100%);transition:transform 0.3s ease} .notification--show{transform:translateX(0)} .notification--success{background:#28a745} .notification--error{background:#dc3545} .notification--info{background:#17a2b8}`;const styleSheet=document.createElement('style');styleSheet.textContent=notificationStyles;document.head.appendChild(styleSheet);
